[![ЮKassa](/i/yookassalogo.png "ЮKassa")](https://yookassa.ru) | [помощь](https://yookassa.ru/docs/support) | [api-докуметация](https://yookassa.ru/developers), [Checkout.js](https://yookassa.ru/developers/payment-forms/other/yc-js) | [SDK](https://yookassa.ru/developers/using-api/using-sdks)

# Замените хост payment.yandex.net на api.yookassa.ru

> Эта страница предназначена для тех контрагентов, кто принимает платежи с помощью **[платежного протокола API ЮKassa](https://yookassa.ru/developers/using-api/interaction-format)** и в качестве адреса для отправки запросов (API endpoint) использует старый хост `payment.yandex.net`.  
> **Обязательно покажите эту информацию вашему техническому специалисту или программисту**, чтобы было выполнено необходимое обновление на вашей стороне.

### Подробности

До конца апреля 2022, в случае, если вы (или ваши технические специалисты, разработчики) не замените старый хост в коде вашей системы на новый, платежи, выполняемые с помощью [платежного протокола API ЮKassa](https://yookassa.ru/developers/using-api/interaction-format), перестанут работать.

### Кратко о том, что необходимо сделать
```
# API endpoint
- old: https://payment.yandex.net/api/v3/
+ new: https://api.yookassa.ru/v3/

# payment_method_data
- "yandex_money"
+ "yoo_money"

# cancellation_details
- "party" : "yandex_checkout"
+ "party" : "yoo_money"
```

# Ответы на вопросы

>> Эта информация только для разработчиков вашего ПО, кто будет выполнять обновление.

## Замена API endpoint

Если Вы не используете готовое [SDK](#sdk) (см. ниже), а код вашего сайта в части работы с ЮKassa написан вашим разработчиком самостоятельно. В коде вашего ПО замените:

```
- old API endpoint: https://payment.yandex.net/api/v3/
+ new API endpoint: https://api.yookassa.ru/v3/
```

## Замена payment_method_data yandex_money

При переходе с хоста payment.yandex.net на api.yookassa.ru меняется название платежного метода `"yandex_money"` на `"yoo_money"`. Если вы не используете этот платежныный метод, можете пропустить этот блок информации.

<details><summary>OLD POST payment.yandex.ru</summary>
    
```CSS
### yandex_money
POST https://payment.yandex.ru/v3/payments
authorization: Basic {{token}}
idempotence-key: {{$guid}}
content-type: application/json

{
    "amount": {
        "value": "10.00",
        "currency": "RUB"
    },
    "payment_method_data": {
        "type": "yandex_money"
    },
    "confirmation": {
        "type": "redirect",
        "return_url": "https://url.to.you_return_page"
    }
}
```
</details>

<details><summary>NEW POST api.yookassa.ru</summary>

> Обновишись для передачи запросов на новый хост, передавайте нам `yoo_money` если необходима оплата методом [электронный кошелек ЮMoney](https://yookassa.ru/developers/payment-acceptance/integration-scenarios/manual-integration/yoo-money#юmoney).

```CSS
### yoo_money
POST https://api.yookassa.ru/v3/payments
authorization: Basic {{token}}
idempotence-key: {{$guid}}
content-type: application/json

{
    "amount": {
        "value": "10.00",
        "currency": "RUB"
    },
    "payment_method_data": {
        "type": "yoo_money"
    },
    "confirmation": {
        "type": "redirect",
        "return_url": "https://url.to.you_return_page"
    }
}
```
</details>

   * В уведомлениях о платеже методом `yoo_money`, а также в нашем ответе на ваш GET запрос,  в объекте платежа, вы будете получать `yoo_money`.
   * Важный момент: если вы создали платёж `"yandex_money"` со старым URL (https://payment.yandex.net/api/v3/), уведомления по этому платежу будут без изменений (метод платежа будет `"yandex_money"`). Но если сделать запрос на новый хост (`GET https://api.yookassa.ru/v3/payments/{{id}}`), в ответе вы получили метод с новым названием — `"yoo_money"`.
   * Если отправить запрос на создание платежа платежным методом `"yandex_money"` (старое название) на новый хост https://api.yookassa.ru/api/v3/, вы получите ошибку, что такого метода не существует. Поэтому на новый хост нужно отправлять запрос только с новым названием метода -- `"yoo_money"`.

## Замена cancellation_details party yoo_money

[В причинах ошибки или отмены платежа](https://yookassa.ru/developers/payment-acceptance/after-the-payment/declined-payments#cancellation-details-party) в уведомлении о платеже или ответе на GET запрос, следующее изменение:

```
- "party" : "yandex_checkout"
+ "party" : "yoo_money"
```
---

## SDK

Если для взаимодействия вы используете устаревшую библиотеку [SDK](https://yookassa.ru/developers/using-api/using-sdks), обновитесь. Новые библиотеки SDK не используют старый адрес, они используют новый. 

### Обновление SDK

В целом процедура обновления библиотеки [SDK](https://yookassa.ru/developers/using-api/using-sdks) это:

1. **Сохранить текущее значение shopid и секретного ключа** из настроечного файла SDK. В случае, если вы не можете найти старые значения, вы можете перевыпустить секретный ключ в личном кабинете ЮKassa в разделе *Интеграция*.
2. Удалить файлы старого SDK (предварительно сделав архив старых файлов).
3. Разместить вместо старых файлов SDK, новые.
4. Прописать в конфигурационном файле SDK shopid и секретный ключ.

#### Композер выдает предупреждения о переходе

Решение: https://github.com/yoomoney/yookassa-sdk-php/issues/15

## CMS

1. Если у вас CMS, найдите инструкцию на нашем сайте https://yookassa.ru/integration/:
![image](/i/how-to-find-yookassa-cms-module-v2.png)
2. Прочитайте инструкцию по установке, настройке, скачайте обновленный модуль и установите его. Или выполните обновление так, как это делается для вашей CMS.

## Старые и новые хосты

>> Эта таблица пригодится вашему программисту, если вы используете при работе с ЮKassa не один протокол.  
>> Для каждого протокола обновился только хост. И если его обновить (см. в таблице значение нового), прописав в коде вашего ПО новый хост, то это гарантия того, что когда старый хост перестанет работать, у вас в плане платежей, возвратов, выплат и т.п., все продолжит работать штатно.

| Протокол | Старый хост | Новый хост |
| -------- | ----------- | ---------- |
|  |
| [API новый платежный](https://yookassa.ru/developers/using-api/basics) | `payment.yandex.net/api/v3` | `api.yookassa.ru/v3/` |
| [Старый платежный протокол](https://yookassa.ru/docs/payment-solution) | `money.yandex.ru/eshop.xml` | `yoomoney.ru/eshop.xml`
| [MWS](https://yookassa.ru/docs/payment-solution/payment-management/basics) | `penelope.yamoney.ru` | `shop.yookassa.ru` |
|  |
| [Протокол выплат](https://yookassa.ru/docs/payouts) | `calypso.yamoney.ru` | `payouts.yookassa.ru` |
| [Протокол зачислений](https://yoomoney.ru/docs/depositions) | `calypso.yamoney.ru` | `deposit.yoomoney.ru` |
| Протокол идентификации кошелька `*` (`makeIdentificationDeposition`) | `calypso.yamoney.ru` | `deposit.yoomoney.ru` |
| Host2host PCI DSS протокол | `paymentcard.yamoney.ru` | `paymentcard.yoomoney.ru` | 

---

## Иные вопросы

### Обновление кода не возможно

**Q:** Мой сайт был сделан давно, я не могу сам поправить код, программиста уже не найти, можете с этим помочь?

**A:** Лучше всего привлечь специалиста, кто знает или сможет понять как работает ваш проект изнутри (код). Если такого не найдете, то напишите нам, посмотрим, что можно сделать. В любом случае, нам потребуется доступ к вашей системе, чтобы внести эту правку. Опять же, сможем ли мы обновить ваш код станет понятно только посмотрев на ваш проект.

### Я уже обновился

**Q:** Я уже все обновил мое ПО и|или модуль CMS, зачем вы мне пишите?

**A:** Выборка была сделана по логам за март 2022. Если вы уже обновились, то хорошо. Если не уверены, то напишите нам, мы посмотрим, куда отправляются ваши запросы по API на текущий момент.

### CMS|SaaS|PaaS

**Q:** Мой сайт написан на известной CMS, как я могу внести правки в ее код?

**A:** Если у вас CMS, то достаточно обновить платежный модуль до последней версии. На текущий момент большинство разработчиков выпустили (начиная с декабря 2020) обновленные версии своих модулей, где внесены все необходимые правки, в том числе, для того, чтобы ваша система начала работать через новый хост `api.yookassa.ru`. Если вы по каким-то причинам не можете выполнить обновление CMS, напишите нам, мы посмотрим, есть ли возможность внести правки в код используемых вами модулей.

### Не могу обновиться

**Q:** А если я не успею обновить?

**A:** К сожалению, платежи перестанут работать. Мы делаем все возможное, чтобы работоспособность всех старых хостов (которые принадлежат Яндексу) была как можно дольше. **Постарайтесь обновиться до конца апреля 2022**.

>> Если все-таки платежи перестанут работать, посмотрите на решение "[Выставление счетов из ЛК ЮKassa](https://yookassa.ru/docs/support/merchant/payments/invoicing)". Оно будет работать всегда вне зависимости от ПО вашего сайта. Это может быть для вас временным решением по приему платежей.

### Почему вообще все это приходится делать?

**Q:** Почему вообще все это приходится делать?

**A:** *Платежный сервис ЮMoney, который входит в экосистему Сбербанка, поменял название юридического лица — ООО НКО «Яндекс.Деньги» в едином государственном реестре юрлиц переименовано в ООО НКО «Юмани». Это стало очередным шагом к окончательной смене бренда.*

*17 сентября компания объявила о переименовании сервиса в ЮMoney, платежное решение для бизнеса изменило название на ЮKassa. До 15 декабря сервис будет использовать старый и новый бренды, после этой даты сервисы будут использовать только новые имена — ЮMoney и ЮKassa ...*

* [О смене бренда](https://new.yookassa.ru/)
* Официальная новость "[Платежный сервис ЮMoney завершает переименование](https://yoomoney.ru/page?id=536896)" (от 12 ноября 2020)

## Текст рассылки

```
Тема: Необходимо изменить адрес payment.yandex.net в настройках вашего shopid=100500

@Коллеги,

По вашему shopid=100500 мы видим, что для платежей (отправка запросов по платежному протоколу ЮKassa от вашего ПО) 
вы используете старый хост payment.yandex.net (адрес принадлежит компании Яндекс).

Вам нужно начать использовать новый хост api.yookassa.ru (принадлежит компании Юмани|ЮKassa), иначе до конца 
апреля 2022 платежи могут перестать работать.

Покажите это письмо вашему техническому специалисту или программисту, чтобы он выполнил необходимое обновление на вашей стороне.

### Что нужно сделать

(разработчик поймет эти две строки ниже)

- old API endpoint: https://payment.yandex.net/api/v3/
+ new API endpoint: https://api.yookassa.ru/v3/

### Подробнее

https://clck.ru/emJBU (ru)
https://clck.ru/enrpY (eng)

(по этим ссылкам мы собрали все необходимые ответы по данному кейсу;
страницы обновляются по мере поступления новой информации) 

Если информации недостаточно, напишите нам в ответ на это письмо.

Пожалуйста, проверьте, чтобы обновление было выполнено на всех учетных записях (shopid) и сайтах, которые вы используете.
```

## У меня есть вопрос

Если остались вопросы или что-то не получается, напишите нам — на b2b_support@yoomoney.ru или в ответ на наше письмо.
